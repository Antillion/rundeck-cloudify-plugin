# DSL version, should appear in the main blueprint.yaml
# and may appear in other imports. In such case, the versions must match
tosca_definitions_version: cloudify_dsl_1_0

imports:
  - http://www.getcloudify.org/spec/cloudify/3.2.1/types.yaml
  - test_plugin.yaml

node_types:
  # Example method of defining a type that will define some sort of common
  # value. The defaults below could come from an input value or from another
  # node (via getProperty).
  antillion.cfyrundeck.SimpleNode:
    derived_from: cloudify.nodes.Root
    interfaces:
      cloudify.interfaces.lifecycle:
        create:
          implementation: antillion.cfyrundeck.jobs.execute
          inputs:
            rundeck_server:
              default: 'rundeck.example.com'
            api_token:
              default: 'SOME_API_TOKEN'

node_templates:
  simple_host:
    type: antillion.cfyrundeck.SimpleNode
    interfaces:
      cloudify.interfaces.lifecycle:
        create:
          inputs:
            ## Overrides
            # Uncommenting the following would override the default defined in SimpleNode
            #rundeck_server: some.other.rundeck.com
            #api_token: 'SOME_OTHER_TOKEN'
            job_id: 'ASDF-ASDFASDFD-ASDFASDF-ASDFASDF'
            poll_in_s: 1
            args:
              stringArg: 'stringVal1, stringVal2'
              numArg: 2
              arrayArg:
                - 3
                - 4
                - 5
            ## Not yet implemented
            # loglevel: 'DEBUG'
            # asUser: 'SomeUser'
            # filters:
            #   hostname: 'Somehostname'

workflows:
  import_job:
    mapping: antillion.cfyrundeck.jobs.import_job
    parameters:
      file_url:
        description: URL to the job
      project:
        description: The name of the project to import into
      format:
        description: yaml / xml
      preserve_uuid:
        description: Whether to preserve the UUID of the job or create a new one
        default: true
      rundeck:
        default: {}
        description: dictionary with hostname and api_token

  import_project:
    mapping: antillion.cfyrundeck.projects.import_archive
    parameters:
      project:
        description: The name of the project that will have the archive imported into
      archive_url:
        description: URL to the project archive
      preserve_uuid:
        default: true
      import_executions:
        default: false
      import_config:
        default: false
      import_acls:
        default: false
      rundeck:
        default: {}
        description: dictionary with hostname and api_token
